<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Invite Friends - StreamPerks</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        :root {
            --bg-dark: #0a0a0f;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-cyan: #00f2ff;
            --neon-cyan-glow: rgba(0, 242, 255, 0.5);
            --text-primary: #ffffff;
            --text-secondary: #b4b4b4;
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --success-color: #28a745;
            --error-color: #ff6464;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: 100px;
            -webkit-font-smoothing: antialiased;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 50%, rgba(0, 242, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);
            animation: bgFloat 20s ease-in-out infinite;
        }
        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(50px, 50px) rotate(180deg); }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 10px;
        }
        .header h1 {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--neon-cyan), #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .header h1 i {
            color: var(--neon-cyan);
            filter: drop-shadow(0 0 15px var(--neon-cyan-glow));
        }
        .header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: var(--glass-bg);
            padding: 6px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
        }
        .tab {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }
        .tab.active {
            background: linear-gradient(135deg, var(--neon-cyan), #9333ea);
            color: white;
            box-shadow: 0 4px 15px var(--neon-cyan-glow);
        }

        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 242, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .stat-card:hover::before {
            opacity: 1;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-cyan);
            box-shadow: 0 10px 30px var(--neon-cyan-glow);
        }
        .stat-icon {
            font-size: 36px;
            margin-bottom: 12px;
            filter: drop-shadow(0 0 10px var(--neon-cyan-glow));
        }
        .stat-icon.users {
            color: var(--neon-cyan);
        }
        .stat-icon.coins {
            color: #ffc107;
        }
        .stat-icon.qualified {
            color: var(--success-color);
        }
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Leaderboard - OPTIMIZED */
        .leaderboard-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        .leaderboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--gold), var(--neon-cyan), #9333ea);
            box-shadow: 0 2px 10px var(--neon-cyan-glow);
        }
        .leaderboard-card h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .leaderboard-card h2 i {
            color: var(--gold);
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        }
        
        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .leaderboard-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            position: relative;
        }
        .leaderboard-item:hover {
            border-color: var(--neon-cyan);
            transform: translateX(5px);
        }
        .leaderboard-item.current-user {
            border-color: var(--neon-cyan);
            background: rgba(0, 242, 255, 0.1);
            box-shadow: 0 0 20px var(--neon-cyan-glow);
        }
        
        /* Rank Badge with Crown Icons */
        .rank-badge {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 800;
            flex-shrink: 0;
            position: relative;
        }
        .rank-badge.gold {
            background: linear-gradient(135deg, var(--gold), #ffa500);
            color: #000;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
        }
        .rank-badge.silver {
            background: linear-gradient(135deg, var(--silver), #999);
            color: #000;
            box-shadow: 0 4px 15px rgba(192, 192, 192, 0.5);
        }
        .rank-badge.bronze {
            background: linear-gradient(135deg, var(--bronze), #b8860b);
            color: #000;
            box-shadow: 0 4px 15px rgba(205, 127, 50, 0.5);
        }
        .rank-badge.regular {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
        }
        .rank-badge .crown-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        .rank-badge .rank-number {
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Circular Avatar - FIXED */
        .leader-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-cyan), #9333ea);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 4px 15px var(--neon-cyan-glow);
            flex-shrink: 0;
            overflow: hidden;
        }
        .leader-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        .leader-info {
            flex: 1;
            min-width: 0;
        }
        .leader-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .leader-stats {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Referral Count Display */
        .leader-count {
            font-weight: 700;
            color: var(--neon-cyan);
            font-size: 18px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
            flex-shrink: 0;
        }
        .leader-count .count-number {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .leader-count .count-label {
            font-size: 10px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
        }

        /* Current User Milestone Display in Leaderboard */
        .current-milestone-card {
            background: rgba(0, 242, 255, 0.1);
            border: 2px solid var(--neon-cyan);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px var(--neon-cyan-glow);
        }
        .current-milestone-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--neon-cyan);
        }
        .milestone-compact {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .milestone-compact .milestone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .milestone-compact .milestone-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .milestone-compact .milestone-reward {
            font-size: 14px;
            font-weight: 700;
            color: #ffc107;
        }
        .milestone-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        .milestone-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), #9333ea);
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--neon-cyan-glow);
        }
        .milestone-progress-text {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Milestones Tab */
        .milestones-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        .milestones-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffc107, var(--neon-cyan));
            box-shadow: 0 2px 10px rgba(255, 193, 7, 0.5);
        }
        .milestones-card h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .milestones-card h2 i {
            color: #ffc107;
            filter: drop-shadow(0 0 10px rgba(255, 193, 7, 0.5));
        }
        .milestones-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .milestone-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        .milestone-item:hover {
            border-color: var(--neon-cyan);
            transform: translateX(5px);
        }
        .milestone-item.completed {
            border-color: var(--success-color);
            background: rgba(40, 167, 69, 0.1);
        }
        .milestone-item.claimed {
            opacity: 0.6;
            background: rgba(100, 100, 100, 0.1);
        }
        .milestone-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--glass-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        .milestone-item.completed .milestone-icon {
            background: linear-gradient(135deg, var(--success-color), #20c997);
            color: white;
        }
        .milestone-item.claimed .milestone-icon {
            background: rgba(100, 100, 100, 0.3);
            color: var(--text-secondary);
        }
        .milestone-content {
            flex: 1;
            min-width: 0;
        }
        .milestone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 8px;
        }
        .milestone-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .milestone-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        .milestone-status.locked {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }
        .milestone-status.completed {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
        }
        .milestone-status.claimed {
            background: rgba(100, 100, 100, 0.2);
            color: var(--text-secondary);
        }
        .milestone-reward-display {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: 600;
        }
        .milestone-reward-display span {
            color: #ffc107;
        }
        .milestone-claim-btn {
            width: 100%;
            margin-top: 10px;
        }

        /* Invite Card */
        .invite-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        .invite-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--neon-cyan), #9333ea);
            box-shadow: 0 2px 10px var(--neon-cyan-glow);
        }
        .invite-card h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .invite-card h2 i {
            color: var(--neon-cyan);
            filter: drop-shadow(0 0 10px var(--neon-cyan-glow));
        }
        .invite-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .invite-link-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            word-break: break-all;
        }
        .invite-link {
            color: var(--neon-cyan);
            font-size: 13px;
            font-family: 'Courier New', monospace;
            text-align: center;
            display: block;
        }
        .btn {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn:active::before {
            width: 400px;
            height: 400px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--neon-cyan), #9333ea);
            color: white;
            box-shadow: 0 6px 20px var(--neon-cyan-glow);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px var(--neon-cyan-glow);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            margin-top: 12px;
        }
        .btn-secondary:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 6px 20px var(--neon-cyan-glow);
        }
        .bonus-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: #000;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
            margin-top: 15px;
        }

        /* Referral Section */
        .referred-section {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
        }
        .referred-section h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .referred-section h2 i {
            color: var(--success-color);
            filter: drop-shadow(0 0 10px rgba(40, 167, 69, 0.5));
        }
        .user-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .user-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        .user-item:hover {
            border-color: var(--neon-cyan);
            transform: translateX(5px);
        }
        .user-item.qualified {
            border-color: var(--success-color);
        }
        .user-item.pending {
            border-color: #ffc107;
            opacity: 0.7;
        }
        .user-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-cyan), #9333ea);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 4px 15px var(--neon-cyan-glow);
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        .status-indicator {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid var(--bg-dark);
        }
        .status-indicator.qualified {
            background: var(--success-color);
        }
        .status-indicator.pending {
            background: #ffc107;
        }
        .user-info {
            flex: 1;
            min-width: 0;
        }
        .user-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .user-date {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .user-bonus {
            font-weight: 700;
            color: #ffc107;
            font-size: 15px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
            flex-shrink: 0;
        }
        .bonus-status {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 10px;
            font-weight: 600;
        }
        .bonus-status.earned {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
        }
        .bonus-status.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        /* Loading & Empty States */
        .loading, .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        .loading i, .empty-state i {
            font-size: 48px;
            color: var(--neon-cyan);
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px var(--neon-cyan-glow));
        }
        .loading i {
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        /* Messages */
        #messageContainer {
            margin-bottom: 20px;
        }
        .message {
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(12px);
            margin-bottom: 10px;
        }
        .message.success {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }
        .message.error {
            background: rgba(255, 100, 100, 0.2);
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(12px);
            border-top: 1px solid var(--glass-border);
            padding: 12px 20px 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -8px 32px rgba(0, 0,0, 0.6);
        }
        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 12px 8px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-decoration: none;
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
        }
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, var(--neon-cyan-glow), transparent);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .nav-btn:active::before {
            width: 200px;
            height: 200px;
        }
        .nav-btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 8px 25px var(--neon-cyan-glow);
        }
        .nav-btn.active {
            background: rgba(0, 242, 255, 0.15);
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            box-shadow: 0 0 25px var(--neon-cyan-glow);
            transform: translateY(-5px);
        }
        .nav-icon {
            font-size: 22px;
            position: relative;
            z-index: 2;
        }
        .nav-btn.active .nav-icon {
            animation: iconBounce 0.6s ease;
        }
        @keyframes iconBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        .nav-label {
            font-size: 11px;
            font-weight: 600;
            position: relative;
            z-index: 2;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Additional Milestone Styles */
        .milestone-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .milestone-card.completed {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1));
            border-color: rgba(255, 215, 0, 0.3);
        }

        .milestone-card .milestone-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .milestone-card.completed .milestone-icon {
            color: #FFD700;
        }

        .milestone-card h3 {
            color: var(--neon-cyan);
            margin-bottom: 10px;
            font-size: 18px;
        }

        .milestone-progress-container {
            margin: 15px 0;
        }

        .milestone-reward {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 14px;
            font-weight: 600;
            color: var(--neon-cyan);
        }

        .milestone-reward i {
            margin-right: 5px;
        }

        .milestone-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .milestone-item.current {
            background: linear-gradient(135deg, rgba(0, 242, 255, 0.1), rgba(138, 43, 226, 0.1));
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px var(--neon-cyan-glow);
        }

        .milestone-item.locked {
            opacity: 0.5;
        }

        .milestone-icon-small {
            font-size: 28px;
            min-width: 40px;
            text-align: center;
        }

        .milestone-item.completed .milestone-icon-small {
            color: #00ff96;
        }

        .milestone-item.current .milestone-icon-small {
            color: var(--neon-cyan);
        }

        .milestone-item.locked .milestone-icon-small {
            color: var(--text-secondary);
        }

        .milestone-title h3 {
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 5px;
        }

        .milestone-rewards {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        .reward-item {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .milestone-item.completed .reward-item {
            color: #00ff96;
        }

        .milestone-item.current .reward-item {
            color: var(--neon-cyan);
        }

        .reward-item i {
            font-size: 16px;
        }

        .user-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .user-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .leaderboard-item.current-user {
            background: linear-gradient(135deg, rgba(0, 242, 255, 0.1), rgba(138, 43, 226, 0.1));
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan-glow);
        }

        .user-item.qualified {
            border-color: rgba(0, 255, 150, 0.3);
        }

        .user-item.pending {
            border-color: rgba(255, 193, 7, 0.3);
        }

        .leaderboard-rank {
            font-size: 18px;
            font-weight: 800;
            min-width: 45px;
            text-align: center;
            color: var(--text-secondary);
        }

        .leaderboard-item.rank-1 .leaderboard-rank {
            color: var(--gold);
            font-size: 24px;
        }

        .leaderboard-item.rank-2 .leaderboard-rank {
            color: var(--silver);
            font-size: 22px;
        }

        .leaderboard-item.rank-3 .leaderboard-rank {
            color: var(--bronze);
            font-size: 20px;
        }

        .leaderboard-info {
            flex: 1;
            min-width: 0;
        }

        .user-avatar.small {
            width: 50px;
            height: 50px;
            font-size: 20px;
        }

        @media (max-width: 480px) {
            .milestone-card {
                padding: 20px;
            }
           
            .milestone-reward {
                flex-direction: column;
                gap: 10px;
            }
           
            .milestone-rewards {
                flex-direction: column;
            }
           
            .user-stats {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-user-plus"></i> Invite Friends</h1>
            <p>Earn Perks by inviting your friends!</p>
        </div>

        <div id="messageContainer"></div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('invite')">
                <i class="fas fa-gift"></i> Invite
            </button>
            <button class="tab" onclick="switchTab('leaderboard')">
                <i class="fas fa-trophy"></i> Leaderboard
            </button>
            <button class="tab" onclick="switchTab('milestones')">
                <i class="fas fa-flag-checkered"></i> Milestones
            </button>
        </div>

        <!-- INVITE TAB -->
        <div id="inviteTab" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon users">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="referralCount">0</div>
                    <div class="stat-label">Total Referrals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon qualified">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-value" id="qualifiedCount">0</div>
                    <div class="stat-label">Qualified Referrals</div>
                </div>
            </div>

            <div class="invite-card">
                <h2><i class="fas fa-gift"></i> Your Invite Link</h2>
                <p class="invite-description">
                    Share your unique link with friends. When they join and watch their first ad, you both earn rewards!
                </p>
                <div class="invite-link-container">
                    <span class="invite-link" id="inviteLink">Loading...</span>
                </div>
                <button class="btn btn-primary" onclick="copyInviteLink()">
                    <i class="fas fa-copy"></i> Copy Invite Link
                </button>
                <button class="btn btn-secondary" onclick="shareInviteLink()">
                    <i class="fas fa-share"></i> Share via Telegram
                </button>
                <div class="bonus-badge" id="bonusBadge">
                    <i class="fas fa-star"></i> Referrals must watch 1 ad to qualify!
                </div>
            </div>

            <div class="referred-section">
                <h2><i class="fas fa-user-check"></i> Your Referrals</h2>
                <div id="referredUsersContainer">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Loading referrals...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- LEADERBOARD TAB -->
        <div id="leaderboardTab" class="tab-content">
            <!-- Current User Milestone Display -->
            <div id="currentMilestoneDisplay"></div>
            
            <div class="leaderboard-card">
                <h2><i class="fas fa-trophy"></i> Top Referrers</h2>
                <div id="leaderboardContainer">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Loading leaderboard...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MILESTONES TAB -->
        <div id="milestonesTab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon qualified">
                        <i class="fas fa-medal"></i>
                    </div>
                    <div class="stat-value" id="qualifiedCountMilestone">0</div>
                    <div class="stat-label">Qualified Referrals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon coins">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-value" id="milestoneEarnings">0</div>
                    <div class="stat-label">Milestone Earnings</div>
                </div>
            </div>

            <div class="milestones-card">
                <h2><i class="fas fa-flag-checkered"></i> Referral Milestones</h2>
                <div id="milestonesContainer">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Loading milestones...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-btn">
            <i class="fas fa-house nav-icon"></i>
            <span class="nav-label">Home</span>
        </a>
        <a href="tasks.html" class="nav-btn">
            <i class="fas fa-list-check nav-icon"></i>
            <span class="nav-label">Tasks</span>
        </a>
        <a href="withdraw.html" class="nav-btn">
            <i class="fas fa-wallet nav-icon"></i>
            <span class="nav-label">Withdraw</span>
        </a>
        <a href="invite.html" class="nav-btn active">
            <i class="fas fa-user-group nav-icon"></i>
            <span class="nav-label">Invite</span>
        </a>
    </nav>

    This is html, up only the script don't add anything else don't add the example don't remove anything from the code just update the error don't remove anything that is not the error
Update this code and give me full code this code is having an error inside it when I tried it I'm seeing too much double size which is not corresponding with telegram web app which is telegram many app and it's not showing the Right thing to update it example like this\
this example don't add this it only example to show you what is happening in The script
example\
ğŸ‰ Miner Activated!\
ğŸ’ Nano Miner\
âš¡ Earnings: $0.5$$ {miner.crypto}/hour\
â±ï¸ Duration: 24 hours\
ğŸ’° Total Earnings: $12.00$$ {miner.crypto}\
Mining will complete at: 10/28/2025, 11:24:52 PM
update only here this script
<script>\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // CONFIGURATION - REPLACE WITH YOUR VALUES\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  const SUPABASE_URL = 'https://xxontbljncxjvznrxnkv.supabase.co';\
Â Â Â Â Â Â Â  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4b250YmxqbmN4anZ6bnJ4bmt2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NDY5MzUsImV4cCI6MjA3NzUyMjkzNX0.vK5cqDjisZ-u5peKFBnVQEsPDcSTqjx9uIni9J7S0p4';\
Â Â Â Â Â Â Â  const TELEGRAM_BOT_USERNAME = 'StreamPerksBot'; // Without @
Â Â Â Â Â Â Â  // Initialize Supabase\
Â Â Â Â Â Â Â  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
Â Â Â Â Â Â Â  // Initialize Telegram WebApp\
Â Â Â Â Â Â Â  const tg = window.Telegram.WebApp;\
Â Â Â Â Â Â Â  tg.ready();\
Â Â Â Â Â Â Â  tg.expand();\
Â Â Â Â Â \
Â Â Â Â Â Â Â  let currentUser = null;\
Â Â Â Â Â Â Â  let referralBonusAmount = 0;\
Â Â Â Â Â Â Â  let currentTab = 'invite';\
Â Â Â Â Â Â Â  let qualifiedReferralsCache = {};\
Â Â Â Â Â Â Â  let claimedMilestonesCache = {};\
Â Â Â Â Â \
Â Â Â Â Â Â Â  // Milestone rewards configuration\
Â Â Â Â Â Â Â  const MILESTONES = [\
Â Â Â Â Â Â Â Â Â Â Â  { target: 10, pex: 2000, usdt: 0.2 },\
Â Â Â Â Â Â Â Â Â Â Â  { target: 25, pex: 5000, usdt: 0.5 },\
Â Â Â Â Â Â Â Â Â Â Â  { target: 50, pex: 10000, usdt: 1 },\
Â Â Â Â Â Â Â Â Â Â Â  { target: 100, pex: 25000, usdt: 2.5 },\
Â Â Â Â Â Â Â Â Â Â Â  { target: 200, pex: 60000, usdt: 6 },\
Â Â Â Â Â Â Â Â Â Â Â  { target: 300, pex: 100000, usdt: 10 }\
Â Â Â Â Â Â Â  ];
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // TAB SWITCHING\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  function switchTab(tabName) {\
Â Â Â Â Â Â Â Â Â Â Â  currentTab = tabName;\
Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  // Update tab buttons\
Â Â Â Â Â Â Â Â Â Â Â  document.querySelectorAll('.tab').forEach(tab => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  tab.classList.remove('active');\
Â Â Â Â Â Â Â Â Â Â Â  });\
Â Â Â Â Â Â Â Â Â Â Â  event.target.closest('.tab').classList.add('active');\
Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  // Update tab content\
Â Â Â Â Â Â Â Â Â Â Â  document.querySelectorAll('.tab-content').forEach(content => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  content.classList.remove('active');\
Â Â Â Â Â Â Â Â Â Â Â  });\
Â Â Â Â Â Â Â Â Â Â Â  document.getElementById(`${tabName}Tab`).classList.add('active');\
Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  // Load tab-specific data\
Â Â Â Â Â Â Â Â Â Â Â  if (tabName === 'leaderboard') {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  loadLeaderboard();\
Â Â Â Â Â Â Â Â Â Â Â  } else if (tabName === 'milestones') {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  loadMilestones();\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  if (tg.HapticFeedback) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  tg.HapticFeedback.impactOccurred('light');\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // INITIALIZATION\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  document.addEventListener('DOMContentLoaded', async () => {\
Â Â Â Â Â Â Â Â Â Â Â  if (TELEGRAM_BOT_USERNAME === 'YOUR_BOT_USERNAME') {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('App configuration error. Please contact support.', 'error');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('CRITICAL: Bot username not configured');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  await initializeUser();\
Â Â Â Â Â Â Â Â Â Â Â  await loadBonusSettings();\
Â Â Â Â Â Â Â Â Â Â Â  generateInviteLink();\
Â Â Â Â Â Â Â Â Â Â Â  await loadUserStats();\
Â Â Â Â Â Â Â Â Â Â Â  await loadReferredUsers();\
Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // USER INITIALIZATION\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function initializeUser() {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const user = tg.initDataUnsafe?.user;\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!user) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('Please open this app from Telegram', 'error');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentUser = user;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Current user initialized:', currentUser.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Check if user exists in database\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: existingUser, error } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('*')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('telegram_id', user.id)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (error && error.code !== 'PGRST116') {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error fetching user:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!existingUser) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Create new user and check for referrer\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const newUser = await createUser(user);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (newUser) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await checkForReferrer();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // User exists, check if they came via referral link but haven't been credited yet\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!existingUser.referrer_id) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await checkForReferrer();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error initializing user:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('Failed to initialize user', 'error');\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // CREATE NEW USER\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function createUser(user) {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Creating new user:', user.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data, error } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .insert([{\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  telegram_id: user.id,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  username: user.username || null,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  first_name: user.first_name || 'User',\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  last_name: user.last_name || null,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  photo_url: user.photo_url || null,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  balance: 0,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  referral_count: 0,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  total_earned: 0,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  total_withdrawn: 0\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }])\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select()\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error creating user:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  throw error;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('New user created successfully:', data);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return data;\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error in createUser:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return null;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // LOAD BONUS SETTINGS\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function loadBonusSettings() {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Load referral bonus\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: referralData, error: referralError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('settings')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('setting_value')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('setting_key', 'referral_bonus')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!referralError && referralData) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  referralBonusAmount = parseFloat(referralData.setting_value) || 1;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  referralBonusAmount = 1;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Referral bonus loaded:', referralBonusAmount);\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error loading bonus settings:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  referralBonusAmount = 1;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // GENERATE INVITE LINK\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  function generateInviteLink() {\
Â Â Â Â Â Â Â Â Â Â Â  if (!currentUser) return;\
Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  const inviteLink = `https://t.me/${TELEGRAM_BOT_USERNAME}/Perks?startapp=${currentUser.id}`;\
Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('inviteLink').textContent = inviteLink;\
Â Â Â Â Â Â Â Â Â Â Â  console.log('Invite link generated:', inviteLink);\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // COPY INVITE LINK\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function copyInviteLink() {\
Â Â Â Â Â Â Â Â Â Â Â  const inviteLink = document.getElementById('inviteLink').textContent;\
Â Â Â Â Â Â Â Â Â Â Â  if (inviteLink === 'Loading...') return;\
Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (navigator.clipboard && navigator.clipboard.writeText) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await navigator.clipboard.writeText(inviteLink);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const textArea = document.createElement('textarea');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  textArea.value = inviteLink;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  textArea.style.position = 'fixed';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  textArea.style.left = '-999999px';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.body.appendChild(textArea);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  textArea.select();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.execCommand('copy');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.body.removeChild(textArea);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('Invite link copied to clipboard!', 'success');\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (tg.HapticFeedback) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  tg.HapticFeedback.notificationOccurred('success');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error copying to clipboard:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('Failed to copy link', 'error');\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // SHARE INVITE LINK\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  function shareInviteLink() {\
Â Â Â Â Â Â Â Â Â Â Â  const inviteLink = document.getElementById('inviteLink').textContent;\
Â Â Â Â Â Â Â Â Â Â Â  if (inviteLink === 'Loading...') return;\
Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  const shareText = `Join me on StreamPerks and start earning rewards!\n\nGet bonus Perks when you sign up using my link!\n\n`;\
Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  if (tg.openTelegramLink) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(inviteLink)}&text=${encodeURIComponent(shareText)}`);\
Â Â Â Â Â Â Â Â Â Â Â  } else {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  window.open(`https://t.me/share/url?url=${encodeURIComponent(inviteLink)}&text=${encodeURIComponent(shareText)}`, '_blank');\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  if (tg.HapticFeedback) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  tg.HapticFeedback.impactOccurred('medium');\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // CHECK FOR REFERRER\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function checkForReferrer() {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const startParam = tg.initDataUnsafe?.start_param;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Start param detected:', startParam);\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!startParam || !currentUser) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('No start param or current user');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const referrerId = parseInt(startParam);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Referrer ID:', referrerId, 'Current User ID:', currentUser.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Don't allow self-referral\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (referrerId === currentUser.id) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Self-referral detected, ignoring');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Check if current user already has a referrer\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: userData, error: userError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('referrer_id, balance, total_earned')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('telegram_id', currentUser.id)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (userError) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error fetching user data:', userError);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  throw userError;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Current user data:', userData);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // If user already has a referrer, don't process again\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (userData.referrer_id) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('User already has a referrer:', userData.referrer_id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Verify referrer exists\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: referrerData, error: referrerCheckError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('telegram_id')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('telegram_id', referrerId)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (referrerCheckError || !referrerData) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Referrer not found in database:', referrerId);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Setting referrer (pending qualification):', referrerId);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await setReferrer(referrerId);\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error checking referrer:', error);\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // SET REFERRER (without immediate reward)\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function setReferrer(referrerId) {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Setting referrer for user:', currentUser.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Update current user's referrer_id only\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { error: updateError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .update({ referrer_id: referrerId })\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('telegram_id', currentUser.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (updateError) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error updating referrer_id:', updateError);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  throw updateError;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Increment referrer's referral_count\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { error: countError } = await supabase.rpc('increment_referral_count', {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  user_telegram_id: referrerId\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (countError) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error incrementing referral count:', countError);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('Referrer set successfully. Awaiting ad watch qualification.');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('Welcome! Watch your first ad to qualify your referrer for rewards!', 'success');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Reload stats\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await loadUserStats();\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error setting referrer:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('Error processing referral', 'error');\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // COUNT QUALIFIED REFERRALS (OPTIMIZED)\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function countQualifiedReferrals(userId) {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Check cache first\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (qualifiedReferralsCache[userId] !== undefined) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return qualifiedReferralsCache[userId];\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Use optimized query with join\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data, error } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('telegram_id')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('referrer_id', userId);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (error) throw error;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!data || data.length === 0) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  qualifiedReferralsCache[userId] = 0;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return 0;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Get qualified referrals (users who watched at least 1 ad)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const referralIds = data.map(r => r.telegram_id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: qualifiedData, error: qualifiedError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('user_ads')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('user_id')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .in('user_id', referralIds);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (qualifiedError) throw qualifiedError;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Count unique qualified users\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const uniqueQualified = new Set(qualifiedData?.map(ad => ad.user_id) || []);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const qualifiedCount = uniqueQualified.size;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Cache the result\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  qualifiedReferralsCache[userId] = qualifiedCount;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return qualifiedCount;\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error counting qualified referrals:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return 0;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // GET CLAIMED MILESTONES\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function getClaimedMilestones(userId) {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Check cache first\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (claimedMilestonesCache[userId] !== undefined) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return claimedMilestonesCache[userId];\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data, error } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('milestone_claims')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('milestone_target')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('user_id', userId);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (error) throw error;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const claimedTargets = data ? data.map(claim => claim.milestone_target) : [];\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Cache the result\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  claimedMilestonesCache[userId] = claimedTargets;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return claimedTargets;\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error fetching claimed milestones:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return [];\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // CLAIM MILESTONE REWARD\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function claimMilestone(milestoneTarget, pexReward, usdtReward) {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!currentUser) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('User not initialized', 'error');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return false;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Get user's database ID\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: userData, error: userError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('id, balance')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('telegram_id', currentUser.id)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (userError) throw userError;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Check if already claimed\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: existingClaim, error: claimCheckError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('milestone_claims')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('id')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('user_id', userData.id)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('milestone_target', milestoneTarget)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (existingClaim) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('This milestone has already been claimed!', 'error');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return false;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Insert milestone claim record\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { error: insertError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('milestone_claims')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .insert([{\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  user_id: userData.id,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  milestone_target: milestoneTarget,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  pex_reward: pexReward,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usdt_reward: usdtReward\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }]);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (insertError) throw insertError;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Update user balance (add PEX reward)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const newBalance = parseFloat(userData.balance) + parseFloat(pexReward);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { error: updateError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .update({\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  balance: newBalance,\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  total_earned: supabase.sql`total_earned + ${pexReward}`\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  })\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('id', userData.id);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (updateError) throw updateError;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Clear cache\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  claimedMilestonesCache[currentUser.id] = undefined;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage(`ğŸ‰ Milestone claimed! You earned ${pexReward} PEX and $${usdtReward} USDT!`, 'success');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (tg.HapticFeedback) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  tg.HapticFeedback.notificationOccurred('success');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Reload milestones and stats\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await loadMilestones();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await loadUserStats();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return true;\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error claiming milestone:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showMessage('Failed to claim milestone. Please try again.', 'error');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return false;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // LOAD USER STATS\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function loadUserStats() {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!currentUser) return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data, error } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('referral_count')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('telegram_id', currentUser.id)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .single();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (error) throw error;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const totalReferrals = data?.referral_count || 0;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const qualifiedCount = await countQualifiedReferrals(currentUser.id);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Update stats display\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('referralCount').textContent = totalReferrals;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('qualifiedCount').textContent = qualifiedCount;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('qualifiedCountMilestone').textContent = qualifiedCount;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Calculate milestone earnings\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const claimedMilestones = await getClaimedMilestones(currentUser.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let totalMilestoneEarnings = 0;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  claimedMilestones.forEach(target => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const milestone = MILESTONES.find(m => m.target === target);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (milestone) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  totalMilestoneEarnings += milestone.pex;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('milestoneEarnings').textContent = totalMilestoneEarnings;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.log('User stats loaded:', { totalReferrals, qualifiedCount, milestoneEarnings: totalMilestoneEarnings });\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error loading user stats:', error);\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // LOAD REFERRED USERS\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function loadReferredUsers() {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!currentUser) return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const container = document.getElementById('referredUsersContainer');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Loading referrals...</p></div>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Get all referrals\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: referrals, error } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('telegram_id, first_name, last_name, username, created_at')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .eq('referrer_id', currentUser.id)\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .order('created_at', { ascending: false });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (error) throw error;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!referrals || referrals.length === 0) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="empty-state">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-user-friends"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3>No Referrals Yet</h3>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p>Share your invite link to start earning!</p>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Get qualified status for each referral\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const referralIds = referrals.map(r => r.telegram_id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: adsData, error: adsError } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('user_ads')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('user_id')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .in('user_id', referralIds);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (adsError) throw adsError;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const qualifiedUserIds = new Set(adsData?.map(ad => ad.user_id) || []);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Build referrals HTML\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let html = '';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  referrals.forEach(referral => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isQualified = qualifiedUserIds.has(referral.telegram_id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const displayName = referral.first_name + (referral.last_name ? ' ' + referral.last_name : '');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const joinDate = new Date(referral.created_at).toLocaleDateString();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const statusClass = isQualified ? 'qualified' : 'pending';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const statusIcon = isQualified ? 'fa-check-circle' : 'fa-clock';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const statusText = isQualified ? 'Qualified' : 'Pending';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const statusColor = isQualified ? '#00ff96' : '#ffc107';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  html += `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-item ${statusClass}">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-avatar">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ${displayName.charAt(0).toUpperCase()}\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-info">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-name">${displayName}</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-details">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ${referral.username ? `@${referral.username}` : 'No username'} â€¢ Joined ${joinDate}\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-status" style="color: ${statusColor}">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas ${statusIcon}"></i> ${statusText}\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = html;\
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error loading referred users:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('referredUsersContainer').innerHTML = `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="empty-state">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-exclamation-triangle"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3>Error Loading Referrals</h3>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p>Please try again later</p>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // LOAD LEADERBOARD\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function loadLeaderboard() {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const container = document.getElementById('leaderboardContainer');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Loading leaderboard...</p></div>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Get all users with their qualified referral counts\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const { data: users, error } = await supabase\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .from('users')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .select('telegram_id, first_name, last_name, username, referral_count')\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .order('referral_count', { ascending: false })\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .limit(100);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (error) throw error;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!users || users.length === 0) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="empty-state">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-trophy"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3>No Data Yet</h3>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p>Be the first to invite friends!</p>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Calculate qualified referrals for top users\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const usersWithQualified = await Promise.all(\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  users.map(async (user) => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const qualifiedCount = await countQualifiedReferrals(user.telegram_id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return { ...user, qualified_count: qualifiedCount };\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  })\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  );
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Sort by qualified referrals\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersWithQualified.sort((a, b) => b.qualified_count - a.qualified_count);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Display current user milestone if in invite tab\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (currentUser) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const currentUserData = usersWithQualified.find(u => u.telegram_id === currentUser.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (currentUserData && currentUserData.qualified_count > 0) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displayCurrentMilestone(currentUserData.qualified_count);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // Build leaderboard HTML\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let html = '';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersWithQualified.forEach((user, index) => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const rank = index + 1;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const displayName = user.first_name + (user.last_name ? ' ' + user.last_name : '');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isCurrentUser = currentUser && user.telegram_id === currentUser.id;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const rankClass = rank <= 3 ? `rank-${rank}` : '';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const currentUserClass = isCurrentUser ? 'current-user' : '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let rankDisplay = rank;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (rank === 1) rankDisplay = 'ğŸ¥‡';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  else if (rank === 2) rankDisplay = 'ğŸ¥ˆ';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  else if (rank === 3) rankDisplay = 'ğŸ¥‰';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  html += `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="leaderboard-item $${rankClass}$$ {currentUserClass}">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="leaderboard-rank">${rankDisplay}</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-avatar small">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ${displayName.charAt(0).toUpperCase()}\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="leaderboard-info">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-name">${displayName}</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="user-stats">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span><i class="fas fa-users"></i> ${user.referral_count} total</span>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span><i class="fas fa-user-check"></i> ${user.qualified_count} qualified</span>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = html;
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error loading leaderboard:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('leaderboardContainer').innerHTML = `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="empty-state">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-exclamation-triangle"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3>Error Loading Leaderboard</h3>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p>Please try again later</p>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // DISPLAY CURRENT MILESTONE\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  function displayCurrentMilestone(qualifiedCount) {\
Â Â Â Â Â Â Â Â Â Â Â  const container = document.getElementById('currentMilestoneDisplay');\
Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  // Find current milestone\
Â Â Â Â Â Â Â Â Â Â Â  let currentMilestone = null;\
Â Â Â Â Â Â Â Â Â Â Â  let progress = 0;\
Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  for (let i = 0; i < MILESTONES.length; i++) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (qualifiedCount < MILESTONES[i].target) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentMilestone = MILESTONES[i];\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  progress = (qualifiedCount / currentMilestone.target) * 100;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  break;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  // If all milestones completed\
Â Â Â Â Â Â Â Â Â Â Â  if (!currentMilestone) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentMilestone = MILESTONES[MILESTONES.length - 1];\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  progress = 100;\
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  const remaining = Math.max(0, currentMilestone.target - qualifiedCount);
Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-card ${progress === 100 ? 'completed' : ''}">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-icon">${progress === 100 ? 'ğŸ†' : 'ğŸ¯'}</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3>${progress === 100 ? 'Milestone Completed!' : 'Next Milestone'}</h3>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p>${currentMilestone.target} Qualified Referrals</p>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-progress-container">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="progress-bar">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="progress-fill" style="width: ${progress}%"></div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="progress-text">$${qualifiedCount} /$$ {currentMilestone.target}</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ${progress < 100 ? `<p style="margin-top: 10px; color: var(--text-secondary);">${remaining} more qualified referrals needed</p>` : ''}\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-reward">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div><i class="fas fa-coins"></i> ${currentMilestone.pex} PEX</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div><i class="fas fa-dollar-sign"></i> ${currentMilestone.usdt} USDT</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // LOAD MILESTONES\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  async function loadMilestones() {\
Â Â Â Â Â Â Â Â Â Â Â  try {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!currentUser) return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const container = document.getElementById('milestonesContainer');\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Loading milestones...</p></div>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const qualifiedCount = await countQualifiedReferrals(currentUser.id);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const claimedMilestones = await getClaimedMilestones(currentUser.id);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let html = '<div class="milestone-list">';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  MILESTONES.forEach((milestone, index) => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isCompleted = qualifiedCount >= milestone.target;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isClaimed = claimedMilestones.includes(milestone.target);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isCurrent = !isCompleted && (index === 0 || qualifiedCount >= MILESTONES[index - 1].target);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isLocked = !isCompleted && !isCurrent;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let statusClass = '';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let statusIcon = '';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let statusText = '';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let actionButton = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isClaimed) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusClass = 'completed';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusIcon = 'âœ…';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusText = 'Claimed';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (isCompleted) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusClass = 'completed';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusIcon = 'ğŸ';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusText = 'Ready to Claim!';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  actionButton = `<button class="btn btn-primary" onclick="claimMilestone($${milestone.target},$$ {milestone.pex}, ${milestone.usdt})" style="margin-top: 15px; width: 100%;"><i class="fas fa-gift"></i> Claim Reward</button>`;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (isCurrent) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusClass = 'current';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusIcon = 'ğŸ¯';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const remaining = milestone.target - qualifiedCount;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusText = `${remaining} more qualified referrals needed`;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusClass = 'locked';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusIcon = 'ğŸ”’';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  statusText = 'Locked';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const progress = Math.min(100, (qualifiedCount / milestone.target) * 100);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  html += `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-item ${statusClass}">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-icon-small">${statusIcon}</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div style="flex: 1;">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-title">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3>${milestone.target} Qualified Referrals</h3>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p style="color: var(--text-secondary); font-size: 13px; margin-top: 5px;">${statusText}</p>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-rewards">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="reward-item">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-coins"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span>${milestone.pex} PEX</span>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="reward-item">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-dollar-sign"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span>${milestone.usdt} USDT</span>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ${!isLocked ? `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="milestone-progress-container" style="margin-top: 10px;">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="progress-bar">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="progress-fill" style="width: ${progress}%"></div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="progress-text">$${qualifiedCount} /$$ {milestone.target}</div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ` : ''}\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ${actionButton}\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  html += '</div>';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  container.innerHTML = html;
Â Â Â Â Â Â Â Â Â Â Â  } catch (error) {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  console.error('Error loading milestones:', error);\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('milestonesContainer').innerHTML = `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <div class="empty-state">\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas fa-exclamation-triangle"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <h3>Error Loading Milestones</h3>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <p>Please try again later</p>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  </div>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // SHOW MESSAGE\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  function showMessage(message, type = 'info') {\
Â Â Â Â Â Â Â Â Â Â Â  const container = document.getElementById('messageContainer');\
Â Â Â Â Â Â Â Â Â Â Â  const messageEl = document.createElement('div');\
Â Â Â Â Â Â Â Â Â Â Â  messageEl.className = `message message-${type}`;\
Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  let icon = 'fa-info-circle';\
Â Â Â Â Â Â Â Â Â Â Â  if (type === 'success') icon = 'fa-check-circle';\
Â Â Â Â Â Â Â Â Â Â Â  else if (type === 'error') icon = 'fa-exclamation-circle';\
Â Â Â Â Â Â Â Â Â Â Â  else if (type === 'warning') icon = 'fa-exclamation-triangle';\
Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  messageEl.innerHTML = `\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <i class="fas ${icon}"></i>\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span>${message}</span>\
Â Â Â Â Â Â Â Â Â Â Â  `;\
Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  container.appendChild(messageEl);\
Â Â Â Â Â Â Â Â Â Â Â \
Â Â Â Â Â Â Â Â Â Â Â  setTimeout(() => {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageEl.style.animation = 'slideOut 0.3s ease-out forwards';\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  setTimeout(() => messageEl.remove(), 300);\
Â Â Â Â Â Â Â Â Â Â Â  }, 5000);\
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  // PERIODIC UPDATES\
Â Â Â Â Â Â Â  // ==========================================\
Â Â Â Â Â Â Â  setInterval(async () => {\
Â Â Â Â Â Â Â Â Â Â Â  if (currentTab === 'invite') {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await loadUserStats();\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await loadReferredUsers();\
Â Â Â Â Â Â Â Â Â Â Â  } else if (currentTab === 'leaderboard') {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await loadLeaderboard();\
Â Â Â Â Â Â Â Â Â Â Â  } else if (currentTab === 'milestones') {\
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await loadMilestones();\
Â Â Â Â Â Â Â Â Â Â Â  }\
Â Â Â Â Â Â Â  }, 30000); // Update every 30 seconds\
Â Â Â  </script>
</body>
</html>

 
